package com.jb.serviceb.web;

import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
public class ControllerB {
    @Autowired
    RestTemplate restTemplate;

    @Value("${spring.cloud.consul.discovery.instanceId}")
    private String instId;

    @HystrixCommand(fallbackMethod = "fallback",groupKey = "srvB", commandKey = "srvB", threadPoolKey = "srvBThread")
    @GetMapping("service/b")
    public String handleB(){
        //String myResult = restTemplate.getForObject("https://data.gov.il/api/3/action/datastore_search?resource_id=053cea08-09bc-40ec-8f7a-156f0677aff3&limit=5",String.class);
        //String myResult = "{\"help\": \"https://data.gov.il/api/3/action/help_show?name=datastore_search\", \"success\": true, \"result\": {\"include_total\": false, \"limit\": 5, \"records_format\": \"objects\", \"resource_id\": \"053cea08-09bc-40ec-8f7a-156f0677aff3\", \"total_estimation_threshold\": null, \"records\": [{\"_id\":1,\"mispar_rechev\":20310102,\"tozeret_cd\":590,\"sug_degem\":\"P\",\"tozeret_nm\":\"מיצובישי יפן\",\"degem_cd\":178,\"degem_nm\":\"GA9WXTHXL6\",\"ramat_gimur\":\"INSTYLE\",\"ramat_eivzur_betihuty\":4,\"kvutzat_zihum\":11,\"shnat_yitzur\":2020,\"degem_manoa\":\"4J11\",\"mivchan_acharon_dt\":\"2020-09-24T00:00:00\",\"tokef_dt\":\"2021-09-23T00:00:00\",\"baalut\":\"ליסינג\",\"misgeret\":\"JMBXTGA9WLU013736\",\"tzeva_cd\":80,\"tzeva_rechev\":\"שנהב לבן\",\"zmig_kidmi\":\"225/55R18\",\"zmig_ahori\":\"225/55R18\",\"sug_delek_nm\":\"בנזין\",\"horaat_rishum\":200100,\"moed_aliya_lakvish\":\"2020-9\",\"kinuy_mishari\":\"ASX\"},{\"_id\":2,\"mispar_rechev\":20310402,\"tozeret_cd\":590,\"sug_degem\":\"P\",\"tozeret_nm\":\"מיצובישי יפן\",\"degem_cd\":178,\"degem_nm\":\"GA9WXTHXL6\",\"ramat_gimur\":\"INSTYLE\",\"ramat_eivzur_betihuty\":4,\"kvutzat_zihum\":11,\"shnat_yitzur\":2020,\"degem_manoa\":\"4J11\",\"mivchan_acharon_dt\":\"2020-09-24T00:00:00\",\"tokef_dt\":\"2021-09-23T00:00:00\",\"baalut\":\"ליסינג\",\"misgeret\":\"JMBXTGA9WLU013965\",\"tzeva_cd\":80,\"tzeva_rechev\":\"שנהב לבן\",\"zmig_kidmi\":\"225/55R18\",\"zmig_ahori\":\"225/55R18\",\"sug_delek_nm\":\"בנזין\",\"horaat_rishum\":200100,\"moed_aliya_lakvish\":\"2020-9\",\"kinuy_mishari\":\"ASX\"},{\"_id\":3627004,\"mispar_rechev\":1002267,\"tozeret_cd\":737,\"sug_degem\":\"P\",\"tozeret_nm\":\"פיאט איטליה\",\"degem_cd\":151,\"degem_nm\":\"199BXA1A\",\"ramat_gimur\":\"ACTIVE\",\"ramat_eivzur_betihuty\":null,\"kvutzat_zihum\":13,\"shnat_yitzur\":2008,\"degem_manoa\":\"199A4000\",\"mivchan_acharon_dt\":\"2021-06-15T00:00:00\",\"tokef_dt\":\"2022-07-15T00:00:00\",\"baalut\":\"פרטי\",\"misgeret\":\"ZFA19900081300354\",\"tzeva_cd\":80,\"tzeva_rechev\":\"שנהב לבן\",\"zmig_kidmi\":\"175/65R15\",\"zmig_ahori\":\"\",\"sug_delek_nm\":\"בנזין\",\"horaat_rishum\":null,\"moed_aliya_lakvish\":\"2008-7\",\"kinuy_mishari\":\"GRANDE PUNTO1.2\"},{\"_id\":4,\"mispar_rechev\":29712102,\"tozeret_cd\":751,\"sug_degem\":\"P\",\"tozeret_nm\":\"שברולט ד.קוריא\",\"degem_cd\":313,\"degem_nm\":\"CM6SA\",\"ramat_gimur\":\"LT PLUS\",\"ramat_eivzur_betihuty\":2,\"kvutzat_zihum\":4,\"shnat_yitzur\":2020,\"degem_manoa\":\"LV7\",\"mivchan_acharon_dt\":\"2020-11-11T00:00:00\",\"tokef_dt\":\"2021-11-10T00:00:00\",\"baalut\":\"ליסינג\",\"misgeret\":\"KL8CM6SA9LC457234\",\"tzeva_cd\":11,\"tzeva_rechev\":\"שחור מטלי\",\"zmig_kidmi\":\"185/55R15\",\"zmig_ahori\":\"185/55R15\",\"sug_delek_nm\":\"בנזין\",\"horaat_rishum\":200024,\"moed_aliya_lakvish\":\"2020-11\",\"kinuy_mishari\":\"SPARK\"},{\"_id\":5,\"mispar_rechev\":29987202,\"tozeret_cd\":981,\"sug_degem\":\"P\",\"tozeret_nm\":\"שברולט מקסיקו\",\"degem_cd\":57,\"degem_nm\":\"AX9EV\",\"ramat_gimur\":\"LT PLUS\",\"ramat_eivzur_betihuty\":6,\"kvutzat_zihum\":14,\"shnat_yitzur\":2021,\"degem_manoa\":\"LYX\",\"mivchan_acharon_dt\":\"2021-02-25T00:00:00\",\"tokef_dt\":\"2022-02-24T00:00:00\",\"baalut\":\"ליסינג\",\"misgeret\":\"3GNAX9EV5LL249837\",\"tzeva_cd\":29,\"tzeva_rechev\":\"כסף מטלי\",\"zmig_kidmi\":\"225/65R17\",\"zmig_ahori\":\"225/65R17\",\"sug_delek_nm\":\"בנזין\",\"horaat_rishum\":200157,\"moed_aliya_lakvish\":\"2021-2\",\"kinuy_mishari\":\"EQUINOX\"}], \"fields\": [{\"id\": \"_id\", \"type\": \"int\"}, {\"id\": \"mispar_rechev\", \"type\": \"numeric\", \"info\": {\"notes\": \"\", \"type_override\": \"numeric\", \"label\": \"\"}}, {\"id\": \"tozeret_cd\", \"type\": \"numeric\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"sug_degem\", \"type\": \"text\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"tozeret_nm\", \"type\": \"text\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"degem_cd\", \"type\": \"numeric\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"degem_nm\", \"type\": \"text\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"ramat_gimur\", \"type\": \"text\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"ramat_eivzur_betihuty\", \"type\": \"numeric\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"kvutzat_zihum\", \"type\": \"numeric\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"shnat_yitzur\", \"type\": \"numeric\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"degem_manoa\", \"type\": \"text\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"mivchan_acharon_dt\", \"type\": \"timestamp\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"tokef_dt\", \"type\": \"timestamp\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"baalut\", \"type\": \"text\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"misgeret\", \"type\": \"text\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}, {\"id\": \"tzeva_cd\", \"type\": \"numeric\"}, {\"id\": \"tzeva_rechev\", \"type\": \"text\"}, {\"id\": \"zmig_kidmi\", \"type\": \"text\"}, {\"id\": \"zmig_ahori\", \"type\": \"text\"}, {\"id\": \"sug_delek_nm\", \"type\": \"text\"}, {\"id\": \"horaat_rishum\", \"type\": \"numeric\"}, {\"id\": \"moed_aliya_lakvish\", \"type\": \"text\"}, {\"id\": \"kinuy_mishari\", \"type\": \"text\", \"info\": {\"notes\": \"\", \"type_override\": \"\", \"label\": \"\"}}], \"_links\": {\"start\": \"/api/3/action/datastore_search?resource_id=053cea08-09bc-40ec-8f7a-156f0677aff3&limit=5\", \"next\": \"/api/3/action/datastore_search?resource_id=053cea08-09bc-40ec-8f7a-156f0677aff3&limit=5&offset=5\"}}}";
        //String myResult = "Hello  my brother from another mother";
        //System.out.println(myResult);
        //return myResult;
        return "Service B ["+instId+"]";
    }

    public String fallback(){
        return "fall back I am B :)";
    }
}
